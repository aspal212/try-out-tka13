<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor Soal Advanced - Try Out TKA13</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-lite.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/admin.css">
</head>
<body>
    <!-- Navigation (same as other admin pages) -->
    
    <!-- Main Content -->
    <div class="container-fluid mt-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col">
                <h2><i class="bi bi-pencil-square"></i> Editor Soal Advanced</h2>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="dashboard.html">Dashboard</a></li>
                        <li class="breadcrumb-item"><a href="questions.html">Manajemen Soal</a></li>
                        <li class="breadcrumb-item active">Editor Advanced</li>
                    </ol>
                </nav>
            </div>
        </div>

        <!-- Question Type Selection -->
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-body">
                        <h5>Pilih Tipe Soal</h5>
                        <div class="row">
                            <div class="col-md-3">
                                <div class="question-type-card" data-type="multiple-choice">
                                    <div class="card h-100 text-center">
                                        <div class="card-body">
                                            <i class="bi bi-check2-circle text-primary" style="font-size: 2rem;"></i>
                                            <h6 class="mt-2">Pilihan Ganda</h6>
                                            <p class="small text-muted">Soal dengan beberapa pilihan jawaban</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="question-type-card" data-type="true-false">
                                    <div class="card h-100 text-center">
                                        <div class="card-body">
                                            <i class="bi bi-toggle-on text-success" style="font-size: 2rem;"></i>
                                            <h6 class="mt-2">Benar/Salah</h6>
                                            <p class="small text-muted">Soal dengan 2 pilihan jawaban</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="question-type-card" data-type="fill-blank">
                                    <div class="card h-100 text-center">
                                        <div class="card-body">
                                            <i class="bi bi-input-cursor text-warning" style="font-size: 2rem;"></i>
                                            <h6 class="mt-2">Isian Kosong</h6>
                                            <p class="small text-muted">Soal dengan jawaban teks pendek</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="question-type-card" data-type="essay">
                                    <div class="card h-100 text-center">
                                        <div class="card-body">
                                            <i class="bi bi-file-text text-info" style="font-size: 2rem;"></i>
                                            <h6 class="mt-2">Essay</h6>
                                            <p class="small text-muted">Soal dengan jawaban panjang</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Question Editor -->
        <div class="row" id="questionEditor" style="display: none;">
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                        <h5 id="editorTitle">Editor Soal</h5>
                    </div>
                    <div class="card-body">
                        <!-- Question Content -->
                        <div class="mb-4">
                            <label class="form-label">Konten Soal</label>
                            <div id="questionEditorContent">
                                <!-- Rich text editor will be initialized here -->
                            </div>
                        </div>

                        <!-- Math Editor -->
                        <div class="mb-4">
                            <label class="form-label">Editor Matematika</label>
                            <div class="row">
                                <div class="col-md-8">
                                    <div id="mathEditor">
                                        <textarea class="form-control" rows="3" placeholder="Masukkan rumus matematika dalam format LaTeX..."></textarea>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <button class="btn btn-outline-primary w-100 mb-2" onclick="insertMathSymbol('\\sqrt{}')">
                                        <i class="bi bi-square-root-alt"></i> Akar
                                    </button>
                                    <button class="btn btn-outline-primary w-100 mb-2" onclick="insertMathSymbol('x^{}')">
                                        <i class="bi bi-superscript"></i> Pangkat
                                    </button>
                                    <button class="btn btn-outline-primary w-100 mb-2" onclick="insertMathSymbol('\\frac{}{}')">
                                        <i class="bi bi-braces-asterisk"></i> Pecahan
                                    </button>
                                    <button class="btn btn-outline-primary w-100" onclick="openMathPreview()">
                                        <i class="bi bi-eye"></i> Preview
                                    </button>
                                </div>
                            </div>
                            <div id="mathPreview" class="mt-2" style="display: none;">
                                <div class="border rounded p-2 bg-light">
                                    <small class="text-muted">Preview:</small>
                                    <div id="mathPreviewContent"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Dynamic Answer Options -->
                        <div class="mb-4" id="answerOptions">
                            <!-- Answer options will be dynamically generated based on question type -->
                        </div>

                        <!-- Media Upload -->
                        <div class="mb-4">
                            <label class="form-label">Media Pendukung</label>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="upload-section">
                                        <input type="file" id="questionImage" accept="image/*" hidden>
                                        <button class="btn btn-outline-secondary w-100" onclick="document.getElementById('questionImage').click()">
                                            <i class="bi bi-image"></i> Tambah Gambar
                                        </button>
                                        <div id="imagePreview" class="mt-2"></div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="upload-section">
                                        <input type="file" id="questionAudio" accept="audio/*" hidden>
                                        <button class="btn btn-outline-secondary w-100" onclick="document.getElementById('questionAudio').click()">
                                            <i class="bi bi-volume-up"></i> Tambah Audio
                                        </button>
                                        <div id="audioPreview" class="mt-2"></div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="upload-section">
                                        <input type="file" id="questionVideo" accept="video/*" hidden>
                                        <button class="btn btn-outline-secondary w-100" onclick="document.getElementById('questionVideo').click()">
                                            <i class="bi bi-play-circle"></i> Tambah Video
                                        </button>
                                        <div id="videoPreview" class="mt-2"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Explanation -->
                        <div class="mb-4">
                            <label class="form-label">Pembahasan dan Penjelasan</label>
                            <textarea class="form-control" id="questionExplanation" rows="4" 
                                placeholder="Berikan penjelasan detail untuk jawaban yang benar..."></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Question Settings Sidebar -->
            <div class="col-lg-4">
                <!-- Basic Settings -->
                <div class="card mb-3">
                    <div class="card-header">
                        <h6>Pengaturan Dasar</h6>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Kategori</label>
                            <select class="form-select" id="questionCategory">
                                <option value="matematika">Matematika</option>
                                <option value="bahasa">Bahasa Indonesia</option>
                                <option value="ipa">IPA</option>
                                <option value="ips">IPS</option>
                                <option value="english">English</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Level Kesulitan</label>
                            <select class="form-select" id="questionDifficulty">
                                <option value="mudah">Mudah</option>
                                <option value="sedang">Sedang</option>
                                <option value="sulit">Sulit</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Tags</label>
                            <input type="text" class="form-control" id="questionTags" placeholder="algebra, geometri,...">
                            <div class="form-text">Pisahkan dengan koma</div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Sumber</label>
                            <input type="text" class="form-control" id="questionSource" placeholder="Buku, сайт, dll">
                        </div>
                    </div>
                </div>

                <!-- Scoring Settings -->
                <div class="card mb-3">
                    <div class="card-header">
                        <h6>Pengaturan Skor</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-6">
                                <label class="form-label">Poin Benar</label>
                                <input type="number" class="form-control" id="correctPoints" value="1" min="0" max="10">
                            </div>
                            <div class="col-6">
                                <label class="form-label">Poin Salah</label>
                                <input type="number" class="form-control" id="wrongPoints" value="0" min="-5" max="0">
                            </div>
                        </div>
                        
                        <div class="form-check mt-3">
                            <input class="form-check-input" type="checkbox" id="negativeScoring">
                            <label class="form-check-label" for="negativeScoring">
                                Aktifkan skor negatif
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Time Settings -->
                <div class="card mb-3">
                    <div class="card-header">
                        <h6>Pengaturan Waktu</h6>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Waktu (detik)</label>
                            <input type="number" class="form-control" id="questionTime" min="10" max="300" value="60">
                            <div class="form-text">0 = tidak terbatas</div>
                        </div>
                        
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="allowReview" checked>
                            <label class="form-check-label" for="allowReview">
                                Izinkan review soal ini
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Security Settings -->
                <div class="card mb-3">
                    <div class="card-header">
                        <h6>Pengaturan Keamanan</h6>
                    </div>
                    <div class="card-body">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="randomizeOptions" checked>
                            <label class="form-check-label" for="randomizeOptions">
                                Acak urutan pilihan jawaban
                            </label>
                        </div>
                        
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="showOnlyOnce">
                            <label class="form-check-label" for="showOnlyOnce">
                                Tampilkan hanya sekali per ujian
                            </label>
                        </div>
                        
                        <div class="form-check">
                            <input class="